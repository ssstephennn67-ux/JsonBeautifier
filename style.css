* { box-sizing: border-box; }
body {
  font-family: ui-monospace, "Cascadia Code", "SF Mono", Monaco, monospace;
  margin: 0;
  padding: 16px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: var(--bg);
  color: var(--text);
  --font-size: 13px;
}
body.font-small { --font-size: 12px; }
body.font-medium { --font-size: 13px; }
body.font-large { --font-size: 15px; }
body.font-xlarge { --font-size: 17px; }

/* Themes */
body.theme-dark { --bg: #1a1b26; --text: #c0caf5; --panel: #24283b; --border: #3b4261; --primary: #7aa2f7; --primary-hover: #89b4fa; --secondary: #3b4261; --secondary-hover: #414868; --key: #7dcfff; --key-index: #bb9af7; --string: #9ece6a; --number: #ff9e64; --muted: #565f89; --error: #f7768e; --hover-bg: rgba(122, 162, 247, 0.15); }
body.theme-light { --bg: #eef0f4; --text: #2c2e3a; --panel: #fff; --border: #c4c8d4; --primary: #2e7de0; --primary-hover: #4a8ee6; --secondary: #c4c8d4; --secondary-hover: #a8adb8; --key: #0d6db4; --key-index: #6e3b8c; --string: #2d7d46; --number: #c44c0a; --muted: #6b6f7d; --error: #c42b2b; --hover-bg: rgba(46, 125, 224, 0.1); }
body.theme-dracula { --bg: #282a36; --text: #f8f8f2; --panel: #44475a; --border: #6272a4; --primary: #bd93f9; --primary-hover: #d4b4ff; --secondary: #6272a4; --secondary-hover: #7c8cb8; --key: #8be9fd; --key-index: #ff79c6; --string: #50fa7b; --number: #ffb86c; --muted: #6272a4; --error: #ff5555; --hover-bg: rgba(189, 147, 249, 0.15); }
body.theme-nord { --bg: #2e3440; --text: #d8dee9; --panel: #3b4252; --border: #4c566a; --primary: #88c0d0; --primary-hover: #8fbcbb; --secondary: #4c566a; --secondary-hover: #5e6778; --key: #81a1c1; --key-index: #b48ead; --string: #a3be8c; --number: #d08770; --muted: #4c566a; --error: #bf616a; --hover-bg: rgba(136, 192, 208, 0.15); }
body.theme-gruvbox { --bg: #282828; --text: #ebdbb2; --panel: #3c3836; --border: #504945; --primary: #fe8019; --primary-hover: #d65d0e; --secondary: #504945; --secondary-hover: #665c54; --key: #83a598; --key-index: #d3869b; --string: #b8bb26; --number: #fabd2f; --muted: #928374; --error: #fb4934; --hover-bg: rgba(254, 128, 25, 0.15); }
body.theme-onedark { --bg: #282c34; --text: #abb2bf; --panel: #21252b; --border: #3e4451; --primary: #61afef; --primary-hover: #528bff; --secondary: #3e4451; --secondary-hover: #4b5263; --key: #e06c75; --key-index: #c678dd; --string: #98c379; --number: #d19a66; --muted: #5c6370; --error: #e06c75; --hover-bg: rgba(97, 175, 239, 0.1); }
body.theme-monokai { --bg: #2d2a2e; --text: #fcfcfa; --panel: #221f22; --border: #403e41; --primary: #ffd866; --primary-hover: #ffcf40; --secondary: #403e41; --secondary-hover: #4d4d4d; --key: #ff6188; --key-index: #ab9df2; --string: #a9dc76; --number: #fc9867; --muted: #727072; --error: #ff6188; --hover-bg: rgba(255, 216, 102, 0.1); }
body.theme-cyberpunk { --bg: #000b1e; --text: #00ff9f; --panel: #00162d; --border: #00d2ff; --primary: #f300ff; --primary-hover: #ff00ea; --secondary: #00162d; --secondary-hover: #002d5a; --key: #00d2ff; --key-index: #ffff00; --string: #00ff9f; --number: #ff0055; --muted: #005670; --error: #ff0055; --hover-bg: rgba(243, 0, 255, 0.15); }
body.theme-rose { --bg: #1c1917; --text: #e7e5e4; --panel: #292524; --border: #44403c; --primary: #f472b6; --primary-hover: #fb7185; --secondary: #44403c; --secondary-hover: #57534e; --key: #67e8f9; --key-index: #c084fc; --string: #86efac; --number: #fcd34d; --muted: #78716c; --error: #f87171; --hover-bg: rgba(244, 114, 182, 0.15); }

h1 { font-size: calc(var(--font-size) * 1.25); margin: 0 0 12px 0; color: var(--primary); }
.toolbar { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; align-items: center; }
.main { display: flex; gap: 16px; flex: 1; min-height: 0; }
.panel-left { flex: 1; min-width: 0; display: flex; flex-direction: column; }
.panel-left.hidden { display: none; }
.panel-right { flex: 1; min-width: 0; display: flex; flex-direction: column; }
.panel-right.full-width { flex: 1 1 100%; }

textarea { width: 100%; flex: 1; min-height: 200px; padding: 12px; background: var(--panel); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: var(--font-size); resize: vertical; }
textarea::placeholder { color: var(--muted); }

button { padding: 8px 14px; border: none; border-radius: 6px; font-size: var(--font-size); cursor: pointer; background: var(--primary); color: var(--bg); display: inline-flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
button:hover { background: var(--primary-hover); }
button.secondary { background: var(--secondary); color: var(--text); }
button.secondary:hover { background: var(--secondary-hover); }

.error { color: var(--error); margin-top: 8px; font-size: var(--font-size); }
.tree { flex: 1; padding: 12px; background: var(--panel); border-radius: 8px; border: 1px solid var(--border); overflow: auto; scrollbar-gutter: stable; }

/* Tree Node Styling */
.node { margin: 2px 0; font-size: var(--font-size); }
.node-head {
  display: flex;
  align-items: center;
  cursor: pointer;
  white-space: nowrap;
}
.node-head:hover { background: var(--hover-bg); }
.toggle { width: 16px; height: 16px; display: inline-flex; align-items: center; justify-content: center; color: var(--muted); }
.toggle.collapsed::before { content: "▶"; font-size: 10px; }
.toggle.expanded::before { content: "▼"; font-size: 10px; }
.node-body { margin-left: 20px; border-left: 1px solid var(--border); }
.key { color: var(--key); font-weight: 500; }
.key-index {
  color: var(--key-index);
  font-weight: bold;
  margin-right: 4px; /* 與箭頭保持距離 */
}
.string { color: var(--string); }
.number { color: var(--number); }
.boolean { color: var(--number); font-weight: bold; }
.null { color: var(--number); font-weight: bold; }
.comma { color: var(--muted); }

/* ... 之前的代碼保持不變 ... */

/* Settings Dialog 樣式強化 */
.settings-backdrop {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0, 0, 0, 0.6); /* 加深背景遮罩 */
  backdrop-filter: blur(4px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}
.settings-backdrop.open { display: flex; }

.settings-dialog {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5);
}

.settings-row { margin-bottom: 24px; }
.settings-label {
  display: block;
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 10px;
  font-weight: bold;
}

.settings-options {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

/* 按鈕選中狀態邏輯 */
.settings-options button {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
  opacity: 0.5; /* 未選中時淡化 */
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.settings-options button:hover {
  opacity: 1;
  background: var(--secondary-hover);
  border-color: var(--primary);
}

/* 被選中的按鈕樣式 - 絕對顯眼 */
.settings-options button.is-active {
  background: var(--primary) !important;
  color: var(--bg) !important;
  opacity: 1;
  font-weight: 800;
  border-color: var(--primary);
  /* 增加雙層外框效果：一層底色，一層主題色 */
  box-shadow: 0 0 0 2px var(--panel), 0 0 0 4px var(--primary);
  transform: translateY(-1px); /* 稍微浮起 */
}

/* 完成按鈕 */
.btn-done {
  width: 100%;
  margin-top: 10px;
  padding: 12px;
  font-weight: bold;
  background: var(--primary);
  color: var(--bg);
}

/* 陣列操作按鈕樣式 */
.array-controls {
  display: inline-flex;
  gap: 4px;
  margin-left: 8px;
  vertical-align: middle;
}
.array-btn {
  padding: 2px 6px;
  font-size: 10px;
  cursor: pointer;
  border-radius: 4px;
  border: 1px solid var(--border);
  background: var(--secondary);
  color: var(--text);
}
.array-btn:hover { background: var(--secondary-hover); }

/* 過濾對話框內容樣式 */
.filter-options-container {
  max-height: 300px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin: 16px 0;
  padding: 10px;
  background: rgba(0,0,0,0.1);
  border-radius: 8px;
}
.filter-item {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}
.filter-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
}

.ellipsis {
  color: var(--muted);
}

/* 確保 Index 數字樣式正確 */
.key-index {
  color: var(--key-index);
  font-weight: bold;
}

.toggle {
  margin-right: 6px;
}

/* 當彈窗開啟時，鎖定頁面捲動 */
body.modal-open {
  overflow: hidden;
}

.settings-backdrop {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px); /* 更強的模糊 */
    z-index: 2000;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.settings-dialog {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 32px;
    width: 95%;
    max-width: 550px;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    transform: scale(1);
    transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.settings-backdrop.open { display: flex; }

.settings-row {
    margin-bottom: 28px;
}

.settings-label {
    display: block;
    font-size: 14px;
    color: var(--primary); /* 改用主色調提示 */
    margin-bottom: 12px;
    font-weight: 600;
    letter-spacing: 0.05em;
    text-transform: uppercase;
}

.settings-options {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

/* 讓按鈕看起來更像膠囊 */
.settings-options button {
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 13px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text);
    transition: all 0.2s;
    cursor: pointer;
}

.settings-options button:hover {
    background: var(--hover-bg);
    border-color: var(--primary);
}

.settings-options button.is-active {
    background: var(--primary);
    color: var(--bg);
    border-color: var(--primary);
    font-weight: bold;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.btn-done {
    width: 100%;
    margin-top: 10px;
    padding: 12px;
    border-radius: 8px;
    background: var(--primary);
    color: var(--bg);
    border: none;
    font-weight: bold;
    font-size: 15px;
    cursor: pointer;
    transition: opacity 0.2s;
}

.btn-done:hover { opacity: 0.9; }